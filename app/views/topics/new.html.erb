<% provide(:title, 'Add topic') %>
<h1>Add Topic</h1>

<hr>

<% if params[:preview] %>
<b>Preview:</b>

<div class="posts_container">
  <div class="post_content">
    <%= @post.content.bbcode_to_html.html_safe %>
  </div>
</div>
<br/>
<% end %>

<div class="row">
  <div class="span6 offset2">
    <%= form_for(@topic) do |f| %>
      <% error_objects = [@topic, @post] %>
      <% error_objects << @game unless @game.nil? %>
      <%= render "shared/multiple_form_error_messages", objects: error_objects %> 
      <%= f.label :title %>
      <%= f.text_field :title %>

      <%= fields_for(:post) do |post| %>
        <%= post.label :content, "Message" %>
        <%= post.text_area :content %>
      <% end %>

      <%= link_to 'Add New Game', '#', id: "new_game" %>
      <br/>
      <div id="new_game_form">
        <div id="game_form">
          <%= fields_for(:game) do |game| %>
            <%= game.label :player_cap %>
            <%= game.number_field :player_cap %>

            <%= game.label :category %>
            &nbsp; <%= game.radio_button :category, 'Normal', checked: true %> Normal Game<br/>
            &nbsp; <%= game.radio_button :category, 'Themed' %> Themed Game<br/>
            &nbsp; <%= game.radio_button :category, 'Newbie' %> Newbie Game<br/><br/>
            Invite Game: <%= game.check_box :invite %> (If checked, players are not put on the signup list until approved).<br/>
          <% end %>
        </div>
      </div>

      <br/>

      <%= f.submit "Post", class: "btn btn-large btn-primary" %>
      <%= f.submit "Preview", name: 'preview', class: "btn btn-large btn-primary" %>
    <% end %>
  </div>
</div>

<div id="holder_form" style="display:none;">
  
</div>
<script>
function add_game() {
  $('#new_game_form').append($("#game_form"));
} 
function remove_game() {
  $('#holder_form').append($("#game_form"));
}
$(document).ready(function() {
  <% if @game.nil? || (@game.new_record? && !@game.errors.any?) %> remove_game(); <% end %>
});
$('a#new_game').live("click", function() {
  if($("#new_game_form").children().length == 0) {
    add_game();
  } else {
    remove_game();
  }
  return false;
});
</script>